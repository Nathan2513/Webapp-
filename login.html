<script type="module">
    import { initializeApp } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-app.js";
    import { getAuth, signInWithEmailAndPassword, GoogleAuthProvider, signInWithPopup } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-auth.js";

    // --- CONFIGURATION FIREBASE ---
    const firebaseConfig = {
        apiKey: "AIzaSyD4dkPbO1C-bZiSokalUnwNqOTpeAyrOU0",
        authDomain: "stockmaster-30835.firebaseapp.com",
        projectId: "stockmaster-30835",
        storageBucket: "stockmaster-30835.firebasestorage.app",
        messagingSenderId: "506097874613",
        appId: "1:506097874613:web:0d15d2bd1575a55c8ab0fc",
        measurementId: "G-2PG7Q471TR"
    };

    // Initialisation Firebase
    const app = initializeApp(firebaseConfig);
    const auth = getAuth(app);
    const provider = new GoogleAuthProvider();

    // R√©cup√©ration des √©l√©ments
    const loginForm = document.getElementById('loginForm');
    const errorBox = document.getElementById('errorBox');

    // ========== CONNEXION EMAIL/PASSWORD ==========
    loginForm.addEventListener('submit', async (e) => {
        e.preventDefault();
        errorBox.style.display = 'none';

        const email = document.getElementById('emailInput').value;
        const password = document.getElementById('passwordInput').value;

        console.log("üîç Tentative de connexion pour:", email);

        try {
            const userCredential = await signInWithEmailAndPassword(auth, email, password);
            console.log("‚úÖ Connexion r√©ussie:", userCredential.user.email);
            
            // Petite pause avant redirection pour que Firebase synchronise
            setTimeout(() => {
                window.location.href = "webapp.html";  // ‚Üê CHANGEMENT ICI
            }, 300);
            
        } catch (error) {
            console.error("‚ùå Erreur de connexion:", error.code, error.message);
            
            let msg = "Email ou mot de passe incorrect.";
            
            // Messages d'erreur personnalis√©s
            if (error.code === 'auth/user-not-found') {
                msg = "Aucun compte trouv√© avec cet email.";
            } else if (error.code === 'auth/wrong-password') {
                msg = "Mot de passe incorrect.";
            } else if (error.code === 'auth/invalid-credential') {
                msg = "Identifiants invalides. V√©rifiez votre email et mot de passe.";
            } else if (error.code === 'auth/invalid-email') {
                msg = "Format d'email invalide.";
            } else if (error.code === 'auth/too-many-requests') {
                msg = "Trop de tentatives. R√©essayez plus tard.";
            } else if (error.code === 'auth/network-request-failed') {
                msg = "Erreur r√©seau. V√©rifiez votre connexion internet.";
            }
            
            errorBox.innerText = msg;
            errorBox.style.display = 'block';
        }
    });

    // ========== CONNEXION GOOGLE ==========
    document.getElementById('googleBtn').addEventListener('click', async () => {
        errorBox.style.display = 'none';
        console.log("üîç Tentative de connexion Google...");

        try {
            const result = await signInWithPopup(auth, provider);
            console.log("‚úÖ Connexion Google r√©ussie:", result.user.email);
            
            setTimeout(() => {
                window.location.href = "webapp.html";  // ‚Üê CHANGEMENT ICI
            }, 300);
            
        } catch (error) {
            console.error("‚ùå Erreur Google:", error.code, error.message);
            
            let msg = "Erreur lors de la connexion avec Google.";
            
            if (error.code === 'auth/popup-blocked') {
                msg = "Les popups sont bloqu√©es. Autorisez-les pour ce site.";
            } else if (error.code === 'auth/popup-closed-by-user') {
                msg = "Connexion annul√©e.";
            } else if (error.code === 'auth/unauthorized-domain') {
                msg = "Ce domaine n'est pas autoris√©. Configurez Firebase Console.";
            } else if (error.code === 'auth/operation-not-allowed') {
                msg = "La connexion Google n'est pas activ√©e. Activez-la dans Firebase Console.";
            }
            
            errorBox.innerText = msg;
            errorBox.style.display = 'block';
        }
    });
</script>
